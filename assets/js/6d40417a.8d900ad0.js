"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[574],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return p}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=d(n),p=r,m=u["".concat(l,".").concat(p)]||u[p]||h[p]||o;return n?a.createElement(m,i(i({ref:t},c),{},{components:n})):a.createElement(m,i({ref:t},c))}));function p(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var d=2;d<o;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},3052:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return l},default:function(){return p},frontMatter:function(){return s},metadata:function(){return d},toc:function(){return h}});var a=n(7462),r=n(3366),o=(n(7294),n(3905)),i=["components"],s={title:"Fetch storables from database"},l=void 0,d={unversionedId:"storables/fetch",id:"storables/fetch",title:"Fetch storables from database",description:"So, in the basics you have learned how to create and store data in the database. Now let's learn how to",source:"@site/docs/storables/fetch.md",sourceDirName:"storables",slug:"/storables/fetch",permalink:"/framelix-docs/docs/storables/fetch",draft:!1,tags:[],version:"current",frontMatter:{title:"Fetch storables from database"},sidebar:"tutorialSidebar",previous:{title:"Basics",permalink:"/framelix-docs/docs/storables/basics"},next:{title:"Update DB scheme",permalink:"/framelix-docs/docs/storables/update-scheme"}},c={},h=[{value:"General",id:"general",level:2},{value:"Fetch methods",id:"fetch-methods",level:2},{value:"getById",id:"getbyid",level:2},{value:"But what if you don&#39;t know the type",id:"but-what-if-you-dont-know-the-type",level:3},{value:"getByIdOrNew",id:"getbyidornew",level:2},{value:"getByIds",id:"getbyids",level:2},{value:"getByCondition/getByConditionOne",id:"getbyconditiongetbyconditionone",level:2},{value:"Depth joins",id:"depth-joins",level:2}],u={toc:h};function p(e){var t=e.components,n=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"So, in ",(0,o.kt)("a",{parentName:"p",href:"/framelix-docs/docs/storables/basics"},"the basics")," you have learned how to create and store data in the database. Now let's learn how to\nfetch existing entries from database. There are really handy features in here."),(0,o.kt)("p",null,"For all this examples, we use the existing storable ",(0,o.kt)("inlineCode",{parentName:"p"},"User")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"UserToken")," from the ",(0,o.kt)("inlineCode",{parentName:"p"},"Framelix")," module for reference."),(0,o.kt)("h2",{id:"general"},"General"),(0,o.kt)("p",null,"The base ",(0,o.kt)("inlineCode",{parentName:"p"},"Storable")," class provide the fetch methods down bellow. Each storable must inherit from this class, so every\nstorable have this methods."),(0,o.kt)("p",null,"The system does check, from which class you call this and does fetch only objects from that class from the database.\nWith this way, we have 100% auto-completion, because the editor knows exactly what instances are returned. You don't\nhave to guess strings and you don't need special editor extensions to make this working."),(0,o.kt)("h2",{id:"fetch-methods"},"Fetch methods"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"getByIdOrNew"),(0,o.kt)("li",{parentName:"ul"},"getById"),(0,o.kt)("li",{parentName:"ul"},"getByIds"),(0,o.kt)("li",{parentName:"ul"},"getByCondition"),(0,o.kt)("li",{parentName:"ul"},"getByConditionOne")),(0,o.kt)("h2",{id:"getbyid"},"getById"),(0,o.kt)("p",null,"This is the most basic fetch method. It expects just an id and it will return the object if the id matches to the\nstorable from which it is called."),(0,o.kt)("p",null,"The system does some clever caching for you, so if you call this 1000x times, only 1 query is executed."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"$user = \\Framelix\\Framelix\\Storable\\User::getById(666);\nif($user) {\n    // this variable only contains a User storable\n    // if the id 666 is used in the database, but is not a User storable, it will be null and not returned\n    echo $user->email;\n}\n")),(0,o.kt)("h3",{id:"but-what-if-you-dont-know-the-type"},"But what if you don't know the type"),(0,o.kt)("p",null,"You can always also call any fetch method from the abstract storable class, which return the matching storable with that\nid from the database."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"$storable = \\Framelix\\Framelix\\Storable\\Storable::getById(222);\nif($storable) {\n    // this variable a storable with id 222 if it exists\n    // at this point, the editor cannot know what storable it is, it only knows it's a Storable\n    // so it depends on you what you now do with this storable\n}\n")),(0,o.kt)("h2",{id:"getbyidornew"},"getByIdOrNew"),(0,o.kt)("p",null,"It's almost the same as ",(0,o.kt)("inlineCode",{parentName:"p"},"getById"),", with the difference as it always returns an instance of given type. If the instance\ndoesn't exist in the database, it returns a new instance of that type, that's not yet is stored in the database."),(0,o.kt)("p",null,"This is usefull when you are on a page where you can create/edit an entry."),(0,o.kt)("h2",{id:"getbyids"},"getByIds"),(0,o.kt)("p",null,"Same as ",(0,o.kt)("inlineCode",{parentName:"p"},"getById"),", expect it excepts an array of ids and then returns an array of objects. If none of the given ids are\nfound in the database, the array just empty but is still an array."),(0,o.kt)("p",null,"The system does also here some clever caching for you, each id that already have been fetching, will not be fetched\nagain, which save performance."),(0,o.kt)("h2",{id:"getbyconditiongetbyconditionone"},"getByCondition/getByConditionOne"),(0,o.kt)("p",null,"Here it is where the fun begins. All above methods internally uses ",(0,o.kt)("inlineCode",{parentName:"p"},"getByCondition")," at the end. Both methods are the\nsame, except ",(0,o.kt)("inlineCode",{parentName:"p"},"getByCondition")," returns an array with all found storables where ",(0,o.kt)("inlineCode",{parentName:"p"},"getByConditionOne")," return just the first\nstorable of that array."),(0,o.kt)("p",null,"A condition in this context is basically everything in the ",(0,o.kt)("inlineCode",{parentName:"p"},"WHERE")," clause in the query."),(0,o.kt)("p",null,"Let's have a simple example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"$user = \\Framelix\\Framelix\\Storable\\User::getByConditionOne('email = {0}', ['my@email.com']);\n// this is set when a user with email 'my@email.com'\n\n$user = \\Framelix\\Framelix\\Storable\\User::getByConditionOne('email = {0} && flagLocked = {1}', ['my@email.com', false]);\n// this is set when a user with email 'my@email.com' and flagLocked is false\n\n$users = \\Framelix\\Framelix\\Storable\\User::getByCondition(sort: '-id', limit: 10);\n// this array contains the last 10 users from the database\n")),(0,o.kt)("h2",{id:"depth-joins"},"Depth joins"),(0,o.kt)("p",null,"One awesome feature are automatic depth joins, or reference joins, however you call it. Let's say you want\nall ",(0,o.kt)("inlineCode",{parentName:"p"},"UserToken")," where the referenced user is not locked."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"$userTokens = \\Framelix\\Framelix\\Storable\\UserToken::getByCondition('user.flagLocked = {0}', [false]);\n// here you have all tokens, where the referenced user in the token has a flagLocked value with false\n")),(0,o.kt)("p",null,"You can go as deep as you want, let's have another example. Let's say you the same as before, but only that token where\nthe user data has been last updated by another user with a specific email. To find out if a specific administrator has\nmodified a user."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"$userTokens = \\Framelix\\Framelix\\Storable\\UserToken::getByCondition('user.flagLocked = {0} && user.updateUser.email = {1}', [false, 'user@gmail.foo']);\n// this checks if token->user->updateUser->email is = 'user@gmail.foo'\n")))}p.isMDXComponent=!0}}]);